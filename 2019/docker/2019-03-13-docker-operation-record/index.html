<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> docker操作记录 · A place for myself to write something</title><meta name="description" content="docker操作记录 - uames"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/uames" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">docker操作记录</h1><div class="post-info">Mar 13, 2019</div><div class="post-content"><h4 id="搜索images中包含mysql的镜像"><a href="#搜索images中包含mysql的镜像" class="headerlink" title="搜索images中包含mysql的镜像"></a>搜索images中包含mysql的镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></table></figure>
<h4 id="获取mysql镜像，且指定其tag为5-7-22"><a href="#获取mysql镜像，且指定其tag为5-7-22" class="headerlink" title="获取mysql镜像，且指定其tag为5.7.22"></a>获取mysql镜像，且指定其tag为5.7.22</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.7.22</span><br></pre></td></tr></table></figure>
<h4 id="查看当前已pull的本地的images-镜像"><a href="#查看当前已pull的本地的images-镜像" class="headerlink" title="查看当前已pull的本地的images(镜像)"></a>查看当前已pull的本地的images(镜像)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<h4 id="运行一个mysql容器，将容器的3306端口映射到本机的3308端口"><a href="#运行一个mysql容器，将容器的3306端口映射到本机的3308端口" class="headerlink" title="运行一个mysql容器，将容器的3306端口映射到本机的3308端口"></a>运行一个mysql容器，将容器的3306端口映射到本机的3308端口</h4><p>-d: Run container in background and print container ID</p>
<p>-p: Publish a container’s port(s) to the host</p>
<p>-e: Set environment variables</p>
<p>–name string: Assign a name to the container<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name dev2-mysql -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=my_db -p 3000:3000 -d mysql:5.7.22</span><br></pre></td></tr></table></figure></p>
<h4 id="若容器没有运行起来，或者运行结果和期望的不一致，可以查看下log记录"><a href="#若容器没有运行起来，或者运行结果和期望的不一致，可以查看下log记录" class="headerlink" title="若容器没有运行起来，或者运行结果和期望的不一致，可以查看下log记录"></a>若容器没有运行起来，或者运行结果和期望的不一致，可以查看下log记录</h4><p>logs后面可以是容器名称或者容器id<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs dev2-mysql</span><br></pre></td></tr></table></figure></p>
<h4 id="通过执行bash登录dev2-mysql容器"><a href="#通过执行bash登录dev2-mysql容器" class="headerlink" title="通过执行bash登录dev2-mysql容器"></a>通过执行bash登录dev2-mysql容器</h4><p>-i: Keep STDIN open even if not attached</p>
<p>-t: Allocate a pseudo-TTY,<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it dev2-mysql bash</span><br></pre></td></tr></table></figure></p>
<h4 id="列出所有容器"><a href="#列出所有容器" class="headerlink" title="列出所有容器"></a>列出所有容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>
<h4 id="停止、删除容器"><a href="#停止、删除容器" class="headerlink" title="停止、删除容器"></a>停止、删除容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop dev2-mysql</span><br><span class="line">docker rm dev2-mysql</span><br></pre></td></tr></table></figure>
<h4 id="运行容器并将一个本地目录映射到容器中。"><a href="#运行容器并将一个本地目录映射到容器中。" class="headerlink" title="运行容器并将一个本地目录映射到容器中。"></a>运行容器并将一个本地目录映射到容器中。</h4><p>-v: Bind mount a volume<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mynginx -p 8080:80 -v /d/ysp:/usr/share/nginx nginx</span><br></pre></td></tr></table></figure></p>
<h4 id="查看当前运行中的容器占用的系统资源"><a href="#查看当前运行中的容器占用的系统资源" class="headerlink" title="查看当前运行中的容器占用的系统资源"></a>查看当前运行中的容器占用的系统资源</h4><p>–no-stream: Disable streaming stats and only pull the first result<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats --no-stream</span><br></pre></td></tr></table></figure></p>
<h4 id="根据DockerFile文件创建一个镜像，注意最后有个“-”"><a href="#根据DockerFile文件创建一个镜像，注意最后有个“-”" class="headerlink" title="根据DockerFile文件创建一个镜像，注意最后有个“.”"></a>根据DockerFile文件创建一个镜像，注意最后有个“.”</h4><p>-t: Name and optionally a tag in the ‘name:tag’ format<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t dao-2048 .</span><br></pre></td></tr></table></figure></p>
<h4 id="查看构成一个mysql镜像的所有的镜像层（包括每一层镜像的大小和形成该层镜像的命令）"><a href="#查看构成一个mysql镜像的所有的镜像层（包括每一层镜像的大小和形成该层镜像的命令）" class="headerlink" title="查看构成一个mysql镜像的所有的镜像层（包括每一层镜像的大小和形成该层镜像的命令）"></a>查看构成一个mysql镜像的所有的镜像层（包括每一层镜像的大小和形成该层镜像的命令）</h4><p>Dockerfile的每一行代码都会形成一个镜像层<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">history</span> mysql</span><br></pre></td></tr></table></figure></p>
<h3 id="有个坑，关于-v挂载目录。"><a href="#有个坑，关于-v挂载目录。" class="headerlink" title="有个坑，关于-v挂载目录。"></a>有个坑，关于-v挂载目录。</h3><p>下面这行代码启动的容器，启动后一分钟内就会自动stop，后面经过尝试，发现是挂载到<code>/usr/share</code>的原因，该文件夹是已经存在且包含了许多文件的，挂载到该目录导致出错了，改为<code>/usr/share/work</code>就好了，docker会自动新建work文件夹。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql -v /d/work:/usr/share ...后面省略</span><br></pre></td></tr></table></figure></p>
<h4 id="查看一个docker容器或镜像的信息（Return-low-level-information-on-Docker-objects）"><a href="#查看一个docker容器或镜像的信息（Return-low-level-information-on-Docker-objects）" class="headerlink" title="查看一个docker容器或镜像的信息（Return low-level information on Docker objects）"></a>查看一个docker容器或镜像的信息（Return low-level information on Docker objects）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect mynginx</span><br></pre></td></tr></table></figure>
<h3 id="关于用Dockerfile初始化mysql数据的坑"><a href="#关于用Dockerfile初始化mysql数据的坑" class="headerlink" title="关于用Dockerfile初始化mysql数据的坑"></a>关于用Dockerfile初始化mysql数据的坑</h3><p>Dockerfile中没有定义CMD的时候，mysql会自动启动，定义了CMD的时候，mysql需要用自己用命令启动————这个是我尝试了好久才得出来的结论。<br>也就是说，如果自己的Dockerfile没有定义CMD，FROM的镜像的Dockerfile中的CMD会被调用，而因为镜像中包含了mysql，CMD命令中一般都会写好它的启动命令。<br>也就是说，假如我的Dockerfile写了CMD命令，其中就必须包含有启动数据库的命令，否则数据库没起来，就像我一样，懵逼老久。<br>数据库启动命令根据不同版本有所不同，我找到了以下两种不同的命令，我使用的是ubuntu下的mysql:5.7.22，启动命令为版本一的：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 版本一</span></span><br><span class="line">chown -R mysql:mysql /var/lib/mysql</span><br><span class="line">mysqld --user=mysql &amp;</span><br><span class="line"><span class="comment"># 版本二</span></span><br><span class="line">chown -R mysql:mysql /var/lib/mysql</span><br><span class="line">mysql_install_db --user=mysql &gt; /dev/null</span><br><span class="line">mysqld_safe --user=mysql &amp;</span><br></pre></td></tr></table></figure></p>
</div></article></div></section><footer><div class="paginator"><a href="/2019/javascript/function的this和prototype/" class="prev">PREV</a><a href="/2019/docker/2019-03-11-docker之dockertags查看image所有tag/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2019 <a href="https://uames.github.io">uames</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>