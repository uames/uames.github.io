webpackJsonp([14],{"6Umz":function(e,t,a){t=e.exports=a("FZ+f")(!0),t.push([e.i,"\n.productPage[data-v-fc0f6d64] {\n}\r\n","",{version:3,sources:["D:/work/git/nxcloud/src/pages/market/YunProduct.vue"],names:[],mappings:";AACA;CACC",file:"YunProduct.vue",sourcesContent:["\n.productPage[data-v-fc0f6d64] {\n}\r\n"],sourceRoot:""}])},RqjL:function(e,t,a){var r=a("6Umz");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("rjj0")("30c4c92e",r,!0,{})},UfPo:function(e,t,a){"use strict";function r(e){a("RqjL")}Object.defineProperty(t,"__esModule",{value:!0});var s=a("mvHQ"),o=a.n(s),i=a("Xxa5"),c=a.n(i),n=a("exGp"),m=a.n(n),u=(a("ABCa"),a("UgCr")),l={name:"YunProduct",components:{},data:function(){return{productInfo:{},totalPrice:0,unitPrice:0,priceLoading:!1,payMent:1,crmData:{city:"",region:"",crmCustId:"",crmCustIdTmp:"",showCusId:"",accountId:"",accountIdTmp:"",showAccountId:"",yunAccountInfo:"",yunAccountTmp:"",bizId:""},userStatus:"",staticData:{isOutAccount:{},accountType:{},charging:{},cloudHost:{},imagesTypeList:[],loginType:{},ipChoose:{},orderType:{},systemType:[],cpu:{},timeList:[],numList:{}},formData:{buyTime:{keyValue:1},buyNum:1,resourcePool:"",systemType:{},imagesType:{},images:{},vpc:"",subNet:"",safeGroup:"",password:"",passwordSure:""},flavorId:"",specsData:{flavorComment:"",flavorDetailList:[],flavorId:"",flavorName:"",flavorPrice:""},resourcePoolList:[],flavorList:[],imagesTypeList:[],imagesSysTemList:[],imagesList:[],vpcList:[],subNetList:[],securityGroupList:[],configLoaidng:!1,configData:[],orderInitData:{},selectResourcePool:{}}},created:function(){this.userStatus=this.$store.getters.userInfo.userStatus;var e=this;e.configLoaidng=!0,setTimeout(function(){e.configLoaidng=!1},2e3),this.getResourceList(),this.getBaseData(),this.getFlavors()},mounted:function(){document.documentElement.scrollTop=0},methods:{resourceChange:function(){try{this.configLoaidng=!0,this.formData.vpc="",this.formData.subNet="",this.formData.securityGroup="",this.getVpc(),this.getImages()}catch(e){console.error(e)}finally{this.configLoaidng=!1}},getResourceList:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return m()(c.a.mark(function a(){var r,s;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,e.configLoaidng=!0,e.formData.resourcePool="",a.next=5,Object(u.y)();case 5:r=a.sent,r.code||(e.resourcePoolList=r,s=r.code?{}:r[0],e.formData.resourcePool=s.regionId,e.selectResourcePool=s,t&&e.resourceChange());case 7:return a.prev=7,e.configLoaidng=!1,a.finish(7);case 10:case"end":return a.stop()}},a,e,[[0,,7,10]])}))()},getFlavors:function(){var e=this;return m()(c.a.mark(function t(){var a,r;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.configLoaidng=!0,t.next=4,Object(u.k)();case 4:a=t.sent,Array.isArray(a)?(e.flavorList=a,e.handleClickFlavor(a[0])):(r={cpuNum:"",flavorName:"",id:"",memSize:""},e.handleClickFlavor(r));case 6:return t.prev=6,e.configLoaidng=!1,t.finish(6);case 9:case"end":return t.stop()}},t,e,[[0,,6,9]])}))()},handleClickFlavor:function(e){if(e){this.flavorId=e.flavorId;for(var t in this.specsData)this.specsData[t]=e[t];this.getPrice()}},getImages:function(){var e=this;return m()(c.a.mark(function t(){var a;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.formData.images={},"{}"!==o()(e.formData.imagesType)&&""!==e.formData.resourcePool){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,e.configLoaidng=!0,t.next=7,Object(u.l)({imageType:e.formData.imagesType.remark,regionId:e.formData.resourcePool});case 7:a=t.sent,e.imagesList=a,e.formData.images=a[0];case 10:return t.prev=10,e.configLoaidng=!1,t.finish(10);case 13:case"end":return t.stop()}},t,e,[[3,,10,13]])}))()},getVpc:function(){var e=this;return m()(c.a.mark(function t(){var a;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(u.v)({type:1,regionId:e.formData.resourcePool,crmBizId:e.crmData.bizId,accountId:""});case 2:a=t.sent,a&&a.length>0?(e.vpcList=a,e.formData.vpc=a[0].resVpcId,e.getSubnets(),e.getSecurityGroup()):e.createVpc();case 4:case"end":return t.stop()}},t,e)}))()},createVpc:function(){var e=this;return m()(c.a.mark(function t(){var a;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.selectResourcePool.zoneId,t.next=3,Object(u.f)({regionId:e.crmData.regionId,zoneId:a,crmBizId:e.crmData.bizId,type:"1",accountId:""});case 3:case"end":return t.stop()}},t,e)}))()},getSubnets:function(){var e=this;return m()(c.a.mark(function t(){var a;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(u.u)({type:1,regionId:e.formData.resourcePool,vpcId:e.formData.vpc,crmBizId:e.crmData.bizId,accountId:""});case 2:a=t.sent,a&&a.length>0&&(e.subNetList=a,e.formData.subNet=a[0].resVlanId);case 4:case"end":return t.stop()}},t,e)}))()},getSecurityGroup:function(){var e=this;return m()(c.a.mark(function t(){var a;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(u.t)({type:1,regionId:e.formData.resourcePool,vpcId:e.formData.vpc,crmBizId:e.crmData.bizId});case 2:a=t.sent,a&&a.length>0&&(e.securityGroupList=a,e.formData.securityGroup=a[0].resSecurityGroupId);case 4:case"end":return t.stop()}},t,e)}))()},getBaseData:function(){var e=this;return m()(c.a.mark(function t(){var a,r,s,o;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=e,t.prev=1,e.configLoaidng=!0,t.next=5,Object(u.r)({typeCode:"1,2,3,4,5,6,7,8,9,10,timeKey,numKey"});case 5:if(r=t.sent,!Array.isArray(r)){t.next=39;break}s=0;case 8:if(!(s<r.length)){t.next=39;break}t.t0=r[s].typeCode,t.next="1"===t.t0?12:"2"===t.t0?14:"3"===t.t0?16:"4"===t.t0?18:"5"===t.t0?20:"6"===t.t0?22:"7"===t.t0?24:"8"===t.t0?26:"9"===t.t0?28:"10"===t.t0?30:"timeKey"===t.t0?32:"numKey"===t.t0?34:36;break;case 12:return a.staticData.isOutAccount=r[s],t.abrupt("break",36);case 14:return a.staticData.accountType=r[s],t.abrupt("break",36);case 16:return a.staticData.charging=r[s],t.abrupt("break",36);case 18:return a.staticData.cloudHost=r[s],t.abrupt("break",36);case 20:return a.staticData.imagesTypeList.push(r[s]),t.abrupt("break",36);case 22:return a.staticData.loginType=r[s],t.abrupt("break",36);case 24:return a.staticData.ipChoose=r[s],t.abrupt("break",36);case 26:return a.staticData.orderType=r[s],t.abrupt("break",36);case 28:return a.staticData.systemType.push(r[s]),t.abrupt("break",36);case 30:return a.staticData.cpu=r[s],t.abrupt("break",36);case 32:return a.staticData.timeList.push(r[s]),t.abrupt("break",36);case 34:return a.staticData.numList=r[s],t.abrupt("break",36);case 36:s++,t.next=8;break;case 39:o=a.staticData.timeList,a.staticData.timeList=o,a.formData.systemType=a.staticData.systemType[0],a.formData.imagesType=a.staticData.imagesTypeList[0],e.formData.buyTime=o[11];case 44:return t.prev=44,e.configLoaidng=!1,t.finish(44);case 47:case"end":return t.stop()}},t,e,[[1,,44,47]])}))()},crmInfo:function(e){this.crmData=e,this.crmData.bizId&&this.getResourceList()},goBack:function(){this.$router.push({name:"market"})},checkCrm:function(){var e=!1,t=/^(?![0-9a-z]+$)(?![0-9A-Z]+$)(?![0-9\W]+$)(?![a-z\W]+$)(?![a-zA-Z]+$)(?![A-Z\W]+$)[a-zA-Z0-9\W_]+$/;return""===this.crmData.crmCustId?(this.$message.error("客户信息不能为空"),e=!0):""===this.crmData.yunAccountInfo?(this.$message.error("平台账户信息不能为空"),e=!0):""===this.formData.resourcePool?(this.$message.error("资源池不能为空"),e=!0):"{}"===o()(this.formData.systemType)?(this.$message.error("系统盘类型不能为空"),e=!0):"{}"===o()(this.formData.images)?(this.$message.error("镜像名称不能为空"),e=!0):""===this.formData.vpc||""===this.formData.subNet?(this.$message.error("请选择网络"),e=!0):""===this.formData.password||""===this.formData.passwordSure?(this.$message.error("请输入密码"),e=!0):this.formData.password!==this.formData.passwordSure?(this.$message.error("请确认两次输入的密码一致"),e=!0):t.test(this.formData.password)||(this.$message.error("密码必须包含大写字母、小写字母、数字和符号其中三项"),e=!0),e},switchData:function(){var e=this,t=[],a=this.resourcePoolList.filter(function(t){return t.regionId===e.formData.resourcePool});t.push({itemCode:"590039898",itemCodeName:a[0].zoneName,itemCodeValue:a[0].regionId,itemId:"590039898",itemIdType:"",itemMode:"",itemName:"资源池"}),t.push({itemCode:"590039907",itemCodeName:e.formData.images.name,itemCodeValue:e.formData.images.id,itemId:"590039907",itemIdType:"",itemMode:"",itemName:"镜像名称"}),t.push({itemCode:"10020441",itemCodeName:e.formData.vpc,itemCodeValue:e.formData.vpc,itemId:"10020441",itemIdType:"",itemMode:"",itemName:"vpc"}),t.push({itemCode:"00006029",itemCodeName:e.crmData.bizId,itemCodeValue:e.crmData.bizId,itemId:"00006029",itemIdType:"",itemMode:"",itemName:"云主机BIZID"}),t.push({itemCode:"590045617",itemCodeName:this.formData.subNet,itemCodeValue:this.formData.subNet,itemId:"590045617",itemIdType:"",itemMode:"",itemName:"子网"}),t.push({itemCode:"590039913",itemCodeName:"default_securitygroup",itemCodeValue:this.formData.securityGroup,itemId:"590039913",itemIdType:"",itemMode:"",itemName:"安全组"}),t.push({itemCode:"590040017",itemCodeName:this.formData.password,itemCodeValue:this.formData.password,itemId:"590040017",itemIdType:"",itemMode:"",itemName:"登录虚拟机的密码"}),t.push({itemCode:"590039900",itemCodeName:a[0].zoneName,itemCodeValue:a[0].zoneId,itemId:"590039900",itemIdType:"",itemMode:"",itemName:"可用区"}),this.specsData.flavorDetailList.forEach(function(e){t.push({itemCode:e.attrId,itemCodeName:"",itemCodeValue:e.attrValue,itemId:"",itemIdType:"",itemMode:"",itemName:"规格"})});for(var r in e.staticData)["timeList"].includes(r)?t.push({itemCode:e.formData.buyTime.keyCode,itemCodeName:e.formData.buyTime.keyName,itemCodeValue:e.formData.buyTime.keyValue,itemId:"",itemIdType:"timeKey",itemMode:"",itemName:""}):["imagesTypeList"].includes(r)?t.push({itemCode:e.formData.imagesType.keyCode,itemCodeName:e.formData.imagesType.keyName,itemCodeValue:e.formData.imagesType.keyValue,itemId:"",itemIdType:"",itemMode:"",itemName:""}):["systemType"].includes(r)?t.push({itemCode:e.formData.systemType.keyCode,itemCodeName:e.formData.systemType.keyName,itemCodeValue:e.formData.systemType.keyValue,itemId:"",itemIdType:"",itemMode:"",itemName:""}):["numList"].includes(r)?t.push({itemCode:e.staticData[r].keyCode,itemCodeName:e.staticData[r].keyName,itemCodeValue:e.formData.buyNum,itemId:"",itemIdType:"",itemMode:"",itemName:""}):t.push({itemCode:e.staticData[r].keyCode,itemCodeName:e.staticData[r].keyName,itemCodeValue:e.staticData[r].keyValue,itemId:"",itemIdType:e.staticData[r].typeCode,itemMode:"",itemName:""});this.configData=t},getPrice:function(){var e=this;return m()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.totalPrice=e.multiply_(e.specsData.flavorPrice,e.formData.buyNum,e.formData.buyTime.keyValue);case 1:case"end":return t.stop()}},t,e)}))()},goOrder:function(e){if(!e)return void this.$message.info("请阅读并勾选商品服务协议");if(!this.checkCrm()){this.switchData();var t=[],a={productId:1,productName:"云主机",orderType:1,perPrice:this.totalPrice,unitPrice:this.totalPrice,data:this.formData,crmData:this.crmData,productFiles:t,configData:this.configData,flavorId:this.specsData.flavorId,flavorName:this.specsData.flavorName,tableShowData:{config:this.specsData.flavorComment,time:this.formData.buyTime.keyName,num:this.formData.buyNum}};this.orderInitData=a,this.payMent=2}},checkPassword:function(e){var t=/^(?![0-9a-z]+$)(?![0-9A-Z]+$)(?![0-9\W]+$)(?![a-z\W]+$)(?![a-zA-Z]+$)(?![A-Z\W]+$)[a-zA-Z0-9\W_]+$/;if(1===e){if(this.formData.password.length<8)return void this.$message.error("密码长度要大于8");t.test(this.formData.password)||this.$message.error("密码必须包含大写字母、小写字母、数字和符号其中三项")}else t.test(this.formData.passwordSure)?this.formData.passwordSure!==this.formData.password&&this.$message.error("密码不一致"):this.$message.error("密码必须包含大写字母、小写字母、数字和符号其中三项")},showPage:function(){this.payMent=1},changePool:function(e){this.selectResourcePool=e,this.formData.resourcePool=e.regionId,this.resourceChange()}}},d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"productPage"},[a("div",{directives:[{name:"show",rawName:"v-show",value:1===e.payMent,expression:"payMent === 1"}],staticClass:"main"},[a("div",{staticClass:"productBox"},[a("div",[a("product-cust-info",{attrs:{cLoading:e.configLoaidng,needTitle:!0,needBizid:!0},on:{crmData:e.crmInfo}}),e._v(" "),a("product-flavor",{attrs:{flavorId:e.flavorId,flavorList:e.flavorList},on:{"change-flavor":e.handleClickFlavor}}),e._v(" "),a("div",{staticClass:"content-section"},[a("section-title",{attrs:{title:"配置"}}),e._v(" "),a("div",[e._v(e._s(JSON.stringify(e.resourcePoolList)))]),e._v(" "),a("el-form-item",{attrs:{label:"资源池",required:""}},[a("el-row",{staticClass:"resource",attrs:{gutter:12}},e._l(e.resourcePoolList,function(t){return a("el-col",{key:t.regionId,staticClass:"resource-item",class:{"active-resourceitem":t.regionId===e.formData.resourcePool},attrs:{span:6,value:t.regionId},nativeOn:{click:function(a){return e.changePool(t)}}},[e._v("\n                "+e._s(t.zoneName)+"\n              ")])}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"系统类型",required:""}},[a("el-select",{staticClass:"w-220",attrs:{size:"small","value-key":"keyValue"},model:{value:e.formData.systemType,callback:function(t){e.$set(e.formData,"systemType",t)},expression:"formData.systemType"}},e._l(e.staticData.systemType,function(e){return a("el-option",{key:e.keyValue,attrs:{label:e.keyValue,value:e}})}),1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"镜像类型",required:""}},[a("el-select",{staticClass:"w-220",attrs:{size:"small","value-key":"keyValue"},on:{change:e.getImages},model:{value:e.formData.imagesType,callback:function(t){e.$set(e.formData,"imagesType",t)},expression:"formData.imagesType"}},e._l(e.staticData.imagesTypeList,function(e){return a("el-option",{key:e.keyValue,attrs:{label:e.keyName,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"镜像名称",required:""}},[a("el-select",{staticClass:"w-220",attrs:{size:"small","value-key":"id"},model:{value:e.formData.images,callback:function(t){e.$set(e.formData,"images",t)},expression:"formData.images"}},e._l(e.imagesList,function(e){return a("el-option",{key:e.keyCode,attrs:{label:e.name,value:e}})}),1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"content-section"},[a("section-title",{attrs:{title:"弹性资源"}}),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"虚拟私有云",required:""}},[a("el-select",{staticClass:"w-220",attrs:{size:"small",placeholder:"请选择虚拟私有云"},model:{value:e.formData.vpc,callback:function(t){e.$set(e.formData,"vpc",t)},expression:"formData.vpc"}},e._l(e.vpcList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.resVpcId}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"子网",required:""}},[a("el-select",{staticClass:"w-220",attrs:{size:"small",placeholder:"请选择子网"},on:{change:e.getSecurityGroup},model:{value:e.formData.subNet,callback:function(t){e.$set(e.formData,"subNet",t)},expression:"formData.subNet"}},e._l(e.subNetList,function(e){return a("el-option",{key:e.resVlanId,attrs:{label:e.name,value:e.resVlanId}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"安全组",required:""}},[a("el-select",{staticClass:"w-220",attrs:{size:"small",placeholder:"请选择安全组"},model:{value:e.formData.securityGroup,callback:function(t){e.$set(e.formData,"securityGroup",t)},expression:"formData.securityGroup"}},e._l(e.securityGroupList,function(e){return a("el-option",{key:e.resSecurityGroupId,attrs:{label:e.name,value:e.resSecurityGroupId}})}),1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"content-section"},[a("section-title",{attrs:{title:"密码"}}),e._v(" "),a("p",{staticClass:"passwordTips"},[e._v("请妥善管理密码，系统无法获取您设置的密码内容。")]),e._v(" "),a("el-form-item",{attrs:{label:"密码",required:""}},[a("el-input",{staticClass:"w-220",attrs:{size:"small","show-password":""},on:{blur:function(t){return e.checkPassword(1)}},model:{value:e.formData.password,callback:function(t){e.$set(e.formData,"password",t)},expression:"formData.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"确认密码",required:""}},[a("el-input",{staticClass:"w-220",attrs:{size:"small","show-password":""},on:{blur:function(t){return e.checkPassword(2)}},model:{value:e.formData.passwordSure,callback:function(t){e.$set(e.formData,"passwordSure",t)},expression:"formData.passwordSure"}})],1)],1)],1)]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.priceLoading,expression:"priceLoading"}],staticClass:"rightBox"},[a("product-tool-box",{attrs:{productInfo:e.productInfo,totalPrice:e.totalPrice,specsData:e.specsData},on:{"go-order":e.goOrder}})],1)]),e._v(" "),a("product-order",{directives:[{name:"show",rawName:"v-show",value:2===e.payMent,expression:"payMent === 2"}],attrs:{orderInitData:e.orderInitData},on:{showPage:e.showPage}})],1)},p=[],f={render:d,staticRenderFns:p},h=f,y=a("VU/8"),g=r,v=y(l,h,!1,g,"data-v-fc0f6d64",null);t.default=v.exports}});