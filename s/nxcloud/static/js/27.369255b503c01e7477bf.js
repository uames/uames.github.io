webpackJsonp([27],{"6Vm7":function(t,e,a){var r=a("P4QC");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("rjj0")("57aad0c4",r,!0,{})},P4QC:function(t,e,a){e=t.exports=a("FZ+f")(!0),e.push([t.i,"\n.productPage[data-v-27e4b05b] {\n}\n.passwordTips[data-v-27e4b05b]{\r\n  font-size: 13px;\r\n  text-align: center;\r\n  margin-bottom: 8px;\r\n  color: #999;\n}\r\n","",{version:3,sources:["D:/work/git/nxcloud/src/pages/market/YunProduct.vue"],names:[],mappings:";AACA;CACC;AACD;EACE,gBAAgB;EAChB,mBAAmB;EACnB,mBAAmB;EACnB,YAAY;CACb",file:"YunProduct.vue",sourcesContent:["\n.productPage[data-v-27e4b05b] {\n}\n.passwordTips[data-v-27e4b05b]{\r\n  font-size: 13px;\r\n  text-align: center;\r\n  margin-bottom: 8px;\r\n  color: #999;\n}\r\n"],sourceRoot:""}])},UfPo:function(t,e,a){"use strict";function r(t){a("6Vm7")}Object.defineProperty(e,"__esModule",{value:!0});var o=a("mvHQ"),s=a.n(o),i=a("Xxa5"),n=a.n(i),c=a("exGp"),m=a.n(c),u=a("wwIJ"),d=a("pDNl"),p=a("UgCr"),f=(u.a,d.a,{name:"YunProduct",components:{Selector:u.a,XInput:d.a},data:function(){return{productInfo:{},totalPrice:0,unitPrice:0,priceLoading:!1,payMent:1,crmData:{city:"",region:"",crmCustId:"",crmCustIdTmp:"",showCusId:"",accountId:"",accountIdTmp:"",showAccountId:"",yunAccountInfo:"",yunAccountTmp:"",bizId:""},userStatus:"",staticData:{isOutAccount:{},accountType:{},charging:{},cloudHost:{},imagesTypeList:[],loginType:{},ipChoose:{},orderType:{},systemType:[],cpu:{},timeList:[],numList:{}},formData:{buyTime:{keyValue:1},buyNum:1,resourcePool:"",systemType:{},imagesType:{},images:{},vpc:"",subNet:"",safeGroup:"",password:"",passwordSure:""},flavorId:"",specsData:{flavorComment:"",flavorDetailList:[],flavorId:"",flavorName:"",flavorPrice:""},resourcePoolList:[],flavorList:[],imagesTypeList:[],imagesSysTemList:[],imagesList:[],vpcList:[],subNetList:[],securityGroupList:[],configLoaidng:!1,configData:[],orderInitData:{},selectResourcePool:{}}},created:function(){this.userStatus=this.$store.getters.userInfo.userStatus;var t=this;t.configLoaidng=!0,setTimeout(function(){t.configLoaidng=!1},2e3),this.getResourceList(),this.getBaseData(),this.getFlavors()},mounted:function(){document.documentElement.scrollTop=0},methods:{resourceChange:function(){try{this.configLoaidng=!0,this.formData.vpc="",this.formData.subNet="",this.formData.securityGroup="",this.getVpc(),this.getImages()}catch(t){console.error(t)}finally{this.configLoaidng=!1}},getResourceList:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return m()(n.a.mark(function a(){var r,o;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t.configLoaidng=!0,t.formData.resourcePool="",a.next=5,Object(p.y)();case 5:r=a.sent,r.code||(t.resourcePoolList=r,o=r.code?{}:r[0],t.formData.resourcePool=o.regionId,t.selectResourcePool=o,e&&t.resourceChange());case 7:return a.prev=7,t.configLoaidng=!1,a.finish(7);case 10:case"end":return a.stop()}},a,t,[[0,,7,10]])}))()},getFlavors:function(){var t=this;return m()(n.a.mark(function e(){var a,r;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.configLoaidng=!0,e.next=4,Object(p.k)();case 4:a=e.sent,Array.isArray(a)?(t.flavorList=a,t.handleClickFlavor(a[0])):(r={cpuNum:"",flavorName:"",id:"",memSize:""},t.handleClickFlavor(r));case 6:return e.prev=6,t.configLoaidng=!1,e.finish(6);case 9:case"end":return e.stop()}},e,t,[[0,,6,9]])}))()},handleClickFlavor:function(t){if(t){this.flavorId=t.flavorId;for(var e in this.specsData)this.specsData[e]=t[e];this.getPrice()}},getImages:function(){var t=this;return m()(n.a.mark(function e(){var a;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.formData.images={},"{}"!==s()(t.formData.imagesType)&&""!==t.formData.resourcePool){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,t.configLoaidng=!0,e.next=7,Object(p.l)({imageType:t.formData.imagesType.remark,regionId:t.formData.resourcePool});case 7:a=e.sent,t.imagesList=a,t.formData.images=a[0];case 10:return e.prev=10,t.configLoaidng=!1,e.finish(10);case 13:case"end":return e.stop()}},e,t,[[3,,10,13]])}))()},getVpc:function(){var t=this;return m()(n.a.mark(function e(){var a;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(p.v)({type:1,regionId:t.formData.resourcePool,crmBizId:t.crmData.bizId,accountId:""});case 2:a=e.sent,a&&a.length>0?(t.vpcList=a,t.formData.vpc=a[0].resVpcId,t.getSubnets(),t.getSecurityGroup()):t.createVpc();case 4:case"end":return e.stop()}},e,t)}))()},createVpc:function(){var t=this;return m()(n.a.mark(function e(){var a;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.selectResourcePool.zoneId,e.next=3,Object(p.f)({regionId:t.crmData.regionId,zoneId:a,crmBizId:t.crmData.bizId,type:"1",accountId:""});case 3:case"end":return e.stop()}},e,t)}))()},getSubnets:function(){var t=this;return m()(n.a.mark(function e(){var a;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(p.u)({type:1,regionId:t.formData.resourcePool,vpcId:t.formData.vpc,crmBizId:t.crmData.bizId,accountId:""});case 2:a=e.sent,a&&a.length>0&&(t.subNetList=a,t.formData.subNet=a[0].resVlanId);case 4:case"end":return e.stop()}},e,t)}))()},getSecurityGroup:function(){var t=this;return m()(n.a.mark(function e(){var a;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(p.t)({type:1,regionId:t.formData.resourcePool,vpcId:t.formData.vpc,crmBizId:t.crmData.bizId});case 2:a=e.sent,a&&a.length>0&&(t.securityGroupList=a,t.formData.securityGroup=a[0].resSecurityGroupId);case 4:case"end":return e.stop()}},e,t)}))()},getBaseData:function(){var t=this;return m()(n.a.mark(function e(){var a,r,o,s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t,e.prev=1,t.configLoaidng=!0,e.next=5,Object(p.r)({typeCode:"1,2,3,4,5,6,7,8,9,10,timeKey,numKey"});case 5:if(r=e.sent,!Array.isArray(r)){e.next=39;break}o=0;case 8:if(!(o<r.length)){e.next=39;break}e.t0=r[o].typeCode,e.next="1"===e.t0?12:"2"===e.t0?14:"3"===e.t0?16:"4"===e.t0?18:"5"===e.t0?20:"6"===e.t0?22:"7"===e.t0?24:"8"===e.t0?26:"9"===e.t0?28:"10"===e.t0?30:"timeKey"===e.t0?32:"numKey"===e.t0?34:36;break;case 12:return a.staticData.isOutAccount=r[o],e.abrupt("break",36);case 14:return a.staticData.accountType=r[o],e.abrupt("break",36);case 16:return a.staticData.charging=r[o],e.abrupt("break",36);case 18:return a.staticData.cloudHost=r[o],e.abrupt("break",36);case 20:return a.staticData.imagesTypeList.push(r[o]),e.abrupt("break",36);case 22:return a.staticData.loginType=r[o],e.abrupt("break",36);case 24:return a.staticData.ipChoose=r[o],e.abrupt("break",36);case 26:return a.staticData.orderType=r[o],e.abrupt("break",36);case 28:return a.staticData.systemType.push(r[o]),e.abrupt("break",36);case 30:return a.staticData.cpu=r[o],e.abrupt("break",36);case 32:return a.staticData.timeList.push(r[o]),e.abrupt("break",36);case 34:return a.staticData.numList=r[o],e.abrupt("break",36);case 36:o++,e.next=8;break;case 39:s=a.staticData.timeList,a.staticData.timeList=s,a.formData.systemType=a.staticData.systemType[0],a.formData.imagesType=a.staticData.imagesTypeList[0],t.formData.buyTime=s[11];case 44:return e.prev=44,t.configLoaidng=!1,e.finish(44);case 47:case"end":return e.stop()}},e,t,[[1,,44,47]])}))()},crmInfo:function(t){this.crmData=t,this.crmData.bizId&&this.getResourceList()},goBack:function(){this.$router.push({name:"market"})},checkCrm:function(){var t=!1,e=/^(?![0-9a-z]+$)(?![0-9A-Z]+$)(?![0-9\W]+$)(?![a-z\W]+$)(?![a-zA-Z]+$)(?![A-Z\W]+$)[a-zA-Z0-9\W_]+$/;return""===this.crmData.crmCustId?(this.$vux.toast.text("客户信息不能为空"),t=!0):""===this.crmData.yunAccountInfo?(this.$vux.toast.text("平台账户信息不能为空"),t=!0):""===this.formData.resourcePool?(this.$vux.toast.text("资源池不能为空"),t=!0):"{}"===s()(this.formData.systemType)?(this.$vux.toast.text("系统盘类型不能为空"),t=!0):"{}"===s()(this.formData.images)?(this.$vux.toast.text("镜像名称不能为空"),t=!0):""===this.formData.vpc||""===this.formData.subNet?(this.$vux.toast.text("请选择网络"),t=!0):""===this.formData.password||""===this.formData.passwordSure?(this.$vux.toast.text("请输入密码"),t=!0):this.formData.password!==this.formData.passwordSure?(this.$vux.toast.text("请确认两次输入的密码一致"),t=!0):e.test(this.formData.password)||(this.$vux.toast.text("密码必须包含大写字母、小写字母、数字和符号其中三项"),t=!0),t},switchData:function(){var t=this,e=[],a=this.resourcePoolList.filter(function(e){return e.regionId===t.formData.resourcePool});e.push({itemCode:"590039898",itemCodeName:a[0].zoneName,itemCodeValue:a[0].regionId,itemId:"590039898",itemIdType:"",itemMode:"",itemName:"资源池"}),e.push({itemCode:"590039907",itemCodeName:t.formData.images.name,itemCodeValue:t.formData.images.id,itemId:"590039907",itemIdType:"",itemMode:"",itemName:"镜像名称"}),e.push({itemCode:"10020441",itemCodeName:t.formData.vpc,itemCodeValue:t.formData.vpc,itemId:"10020441",itemIdType:"",itemMode:"",itemName:"vpc"}),e.push({itemCode:"00006029",itemCodeName:t.crmData.bizId,itemCodeValue:t.crmData.bizId,itemId:"00006029",itemIdType:"",itemMode:"",itemName:"云主机BIZID"}),e.push({itemCode:"590045617",itemCodeName:this.formData.subNet,itemCodeValue:this.formData.subNet,itemId:"590045617",itemIdType:"",itemMode:"",itemName:"子网"}),e.push({itemCode:"590039913",itemCodeName:"default_securitygroup",itemCodeValue:this.formData.securityGroup,itemId:"590039913",itemIdType:"",itemMode:"",itemName:"安全组"}),e.push({itemCode:"590040017",itemCodeName:this.formData.password,itemCodeValue:this.formData.password,itemId:"590040017",itemIdType:"",itemMode:"",itemName:"登录虚拟机的密码"}),e.push({itemCode:"590039900",itemCodeName:a[0].zoneName,itemCodeValue:a[0].zoneId,itemId:"590039900",itemIdType:"",itemMode:"",itemName:"可用区"}),this.specsData.flavorDetailList.forEach(function(t){e.push({itemCode:t.attrId,itemCodeName:"",itemCodeValue:t.attrValue,itemId:"",itemIdType:"",itemMode:"",itemName:"规格"})});for(var r in t.staticData)["timeList"].includes(r)?e.push({itemCode:t.formData.buyTime.keyCode,itemCodeName:t.formData.buyTime.keyName,itemCodeValue:t.formData.buyTime.keyValue,itemId:"",itemIdType:"timeKey",itemMode:"",itemName:""}):["imagesTypeList"].includes(r)?e.push({itemCode:t.formData.imagesType.keyCode,itemCodeName:t.formData.imagesType.keyName,itemCodeValue:t.formData.imagesType.keyValue,itemId:"",itemIdType:"",itemMode:"",itemName:""}):["systemType"].includes(r)?e.push({itemCode:t.formData.systemType.keyCode,itemCodeName:t.formData.systemType.keyName,itemCodeValue:t.formData.systemType.keyValue,itemId:"",itemIdType:"",itemMode:"",itemName:""}):["numList"].includes(r)?e.push({itemCode:t.staticData[r].keyCode,itemCodeName:t.staticData[r].keyName,itemCodeValue:t.formData.buyNum,itemId:"",itemIdType:"",itemMode:"",itemName:""}):e.push({itemCode:t.staticData[r].keyCode,itemCodeName:t.staticData[r].keyName,itemCodeValue:t.staticData[r].keyValue,itemId:"",itemIdType:t.staticData[r].typeCode,itemMode:"",itemName:""});this.configData=e},getPrice:function(){var t=this;return m()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.totalPrice=t.multiply_(t.specsData.flavorPrice,t.formData.buyNum,t.formData.buyTime.keyValue);case 1:case"end":return e.stop()}},e,t)}))()},goOrder:function(t){if(!t)return void this.$vux.toast.text("请阅读并勾选商品服务协议");if(!this.checkCrm()){this.switchData();var e=[],a={productId:1,productName:"云主机",orderType:1,perPrice:this.totalPrice,unitPrice:this.totalPrice,data:this.formData,crmData:this.crmData,productFiles:e,configData:this.configData,flavorId:this.specsData.flavorId,flavorName:this.specsData.flavorName,tableShowData:{config:this.specsData.flavorComment,time:this.formData.buyTime.keyName,num:this.formData.buyNum}};this.orderInitData=a,this.payMent=2}},warnToast:function(t){this.$vux.toast.show({text:t,type:"warn"})},checkPassword:function(t){var e=/^(?![0-9a-z]+$)(?![0-9A-Z]+$)(?![0-9\W]+$)(?![a-z\W]+$)(?![a-zA-Z]+$)(?![A-Z\W]+$)[a-zA-Z0-9\W_]+$/;if(1===t){if(this.formData.password.length<8)return void this.warnToast("密码长度要大于8");e.test(this.formData.password)||this.warnToast("密码必须包含大写字母、小写字母、数字和符号其中三项")}else e.test(this.formData.passwordSure)?this.formData.passwordSure!==this.formData.password&&this.warnToast("密码不一致"):this.warnToast("密码必须包含大写字母、小写字母、数字和符号其中三项")},showPage:function(){this.payMent=1},changePool:function(t){this.selectResourcePool=t,this.formData.resourcePool=t.regionId,this.resourceChange()}}}),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"productPage"},[a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.payMent,expression:"payMent === 1"}],staticClass:"main"},[a("div",{staticClass:"productBox"},[a("div",[a("product-cust-info",{attrs:{cLoading:t.configLoaidng,needTitle:!0,needBizid:!0},on:{crmData:t.crmInfo}}),t._v(" "),a("product-flavor",{attrs:{flavorId:t.flavorId,flavorList:t.flavorList},on:{"change-flavor":t.handleClickFlavor}}),t._v(" "),a("div",{staticClass:"content-section"},[a("section-title",{attrs:{title:"配置"}}),t._v(" "),a("selector",{attrs:{"value-map":["regionId","regionId"],title:"资源池",options:t.resourcePoolList},on:{"on-change":t.changePool},model:{value:t.formData.resourcePool,callback:function(e){t.$set(t.formData,"resourcePool",e)},expression:"formData.resourcePool"}}),t._v(" "),a("selector",{attrs:{"value-map":["keyValue","keyValue"],title:"系统类型",options:t.staticData.systemType},model:{value:t.formData.systemType,callback:function(e){t.$set(t.formData,"systemType",e)},expression:"formData.systemType"}}),t._v(" "),a("selector",{attrs:{"value-map":["keyValue","keyName"],title:"镜像类型",options:t.staticData.imagesTypeList},on:{"on-change":t.getImages},model:{value:t.formData.imagesType,callback:function(e){t.$set(t.formData,"imagesType",e)},expression:"formData.imagesType"}}),t._v(" "),a("selector",{attrs:{"value-map":["keyCode","name"],title:"镜像名称",options:t.imagesList},model:{value:t.formData.images,callback:function(e){t.$set(t.formData,"images",e)},expression:"formData.images"}})],1),t._v(" "),a("div",{staticClass:"content-section"},[a("section-title",{attrs:{title:"弹性资源"}}),t._v(" "),a("selector",{attrs:{"value-map":["id","name"],placeholder:"请选择虚拟私有云",title:"虚拟私有云",options:t.vpcList},model:{value:t.formData.vpc,callback:function(e){t.$set(t.formData,"vpc",e)},expression:"formData.vpc"}}),t._v(" "),a("selector",{attrs:{"value-map":["resVlanId","name"],placeholder:"请选择子网",title:"子网",options:t.subNetList},on:{"on-change":t.getSecurityGroup},model:{value:t.formData.subNet,callback:function(e){t.$set(t.formData,"subNet",e)},expression:"formData.subNet"}}),t._v(" "),a("selector",{attrs:{"value-map":["resSecurityGroupId","name"],placeholder:"请选择安全组",title:"安全组",options:t.securityGroupList},model:{value:t.formData.securityGroup,callback:function(e){t.$set(t.formData,"securityGroup",e)},expression:"formData.securityGroup"}})],1),t._v(" "),a("div",{staticClass:"content-section"},[a("section-title",{attrs:{title:"密码"}}),t._v(" "),a("p",{staticClass:"passwordTips"},[t._v("请妥善管理密码，系统无法获取您设置的密码内容。")]),t._v(" "),a("x-input",{attrs:{title:"密码","label-width":"10",placeholder:"请输入密码",type:"password"},on:{"on-blur":function(e){return t.checkPassword(1)}},model:{value:t.formData.password,callback:function(e){t.$set(t.formData,"password",e)},expression:"formData.password"}}),t._v(" "),a("x-input",{attrs:{title:"确认密码","label-width":"10",placeholder:"请确认密码",type:"password"},on:{"on-blur":function(e){return t.checkPassword(2)}},model:{value:t.formData.passwordSure,callback:function(e){t.$set(t.formData,"passwordSure",e)},expression:"formData.passwordSure"}})],1)],1)]),t._v(" "),a("div",{staticClass:"rightBox"},[a("product-tool-box",{attrs:{productInfo:t.productInfo,totalPrice:t.totalPrice,specsData:t.specsData},on:{"go-order":t.goOrder}})],1)])])},h=[],v={render:l,staticRenderFns:h},D=v,y=a("VU/8"),g=r,b=y(f,D,!1,g,"data-v-27e4b05b",null);e.default=b.exports}});